# Packaging Workspace

This workspace manages packaging for various distribution channels.

## Structure
- `aur/`: Arch User Repository packages
- `docker/`: Docker container images (planned)
- `nvchecker.toml`: Version checking configuration
- `.github/workflows/`: Automated update workflows

## Adding a New AUR Package

1. **Add to nvchecker.toml**:
   ```toml
   # For npm packages:
   [my-package]
   source = "npm"
   npm = "my-package"
   
   # For GitHub releases:
   [my-package]
   source = "github"
   github = "owner/repo"
   use_latest_release = true
   prefix = "v"  # if tags are like v1.2.3
   
   # For -git packages (track HEAD):
   [my-package-git]
   source = "git"
   git = "https://github.com/owner/repo.git"
   use_commit = true
   ```

2. **Add initial version to `.github/nvchecker/old_ver.json`**:
   ```json
   {
     "my-package": "1.0.0"
   }
   ```
   For -git packages, use the short commit hash (7 chars).

3. **Create package directory**:
   ```
   aur/my-package/
   ├── PKGBUILD
   ├── AGENTS.md      # Package-specific build/test instructions
   └── .SRCINFO       # Generated by makepkg --printsrcinfo
   ```

4. **Push to main** - automation will handle the rest.

## Automation (GitHub Actions + OpenCode)

Daily automated workflow:
1. **nvchecker** detects upstream version changes
2. **OpenCode** (claude-opus-4-5) prepares updates in Arch container:
   - Updates PKGBUILD
   - Runs `updpkgsums`
   - Builds with `makepkg -sf` and observes output
   - Smoke tests the install
   - Generates `.SRCINFO`
3. Creates **PR with changelog** for human review (or Issue if build fails)
4. On PR merge, **auto-pushes to AUR**

### Secrets Required
- `LLM_PROXY_API_KEY`: OpenCode LLM access
- `AUR_SSH_PRIVATE_KEY`: SSH key for AUR push

### Manual Trigger
Run workflow manually: Actions → "AUR Package Update Check" → Run workflow

## Tools
- `makepkg`: Build Arch packages
- `updpkgsums`: Update checksums in PKGBUILD
- `namcap`: Package quality control (install if missing)
- `nvchecker`: Upstream version detection

## Global Policies
- **License**: Ensure proper SPDX identifiers
- **Security**: Don't embed secrets
- **Communication**: Use concise commit messages
